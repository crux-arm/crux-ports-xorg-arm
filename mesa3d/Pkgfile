# Description: Mesa 3D Graphics Library
# URL: http://www.mesa3d.org
# Maintainer: CRUX Xorg Team, xorg-ports at crux dot nu
# Arch Maintainer: CRUX-ARM System Team, devel at crux-arm dot nu
# Depends on: elfutils libdrm libvdpau libglvnd llvm xorg-libxdamage xorg-libxshmfence xorg-libxvmc xorg-libxxf86vm python3-mako

name=mesa3d
version=19.2.1
release=1
source=(ftp://ftp.freedesktop.org/pub/mesa/mesa-$version.tar.xz)

build() {
  cd mesa-$version

  meson build --prefix=/usr \
              --sysconfdir=/etc \
              -Dllvm=true \
              -Dgbm=true \
              -Dgles1=true \
              -Dgles2=true \
              -Dosmesa=gallium \
              -Dgallium-xa=true \
              -Dshared-llvm=true \
              -Dplatforms=x11,drm \
              -Dgallium-drivers=swrast,freedreno,lima,kmsro \
              -Dglvnd=true  



        DESTDIR=$PKG ninja -C build -j ${JOBS:-1} install

  # indirect rendering symlink
  ln -s libGLX_mesa.so.0 $PKG/usr/lib/libGLX_indirect.so.0
}
